server:
  port: 8080 # Port standard interne (exposé via Docker ou direct)

spring:
  application:
    name: organisation-service
  
  # Désactive Docker Compose automatique (on gère l'infra manuellement ou via script)
  docker:
    compose:
      enabled: false

  # --- DATABASE (Local) ---
  r2dbc:
    url: r2dbc:postgresql://localhost:5432/organisationdb
    username: postgres
    password: password
    pool:
      enabled: true
      initial-size: 1
      max-size: 5
      max-idle-time: 30m
      max-life-time: 10m
      acquire-retry: 3
      max-acquire-time: 30s
      validation-query: SELECT 1
  sql:
    init:
      mode: always # Initialise la DB via schema.sql

  # --- REDIS (Local - Standalone) ---
  data:
    redis:
      host: localhost
      port: 6379
      # Pas de cluster en local

  # --- KAFKA (Local) ---
  kafka:
    bootstrap-servers: localhost:9092
    consumer:
      group-id: organisation-group
      auto-offset-reset: earliest
      key-deserializer: org.apache.kafka.common.serialization.StringDeserializer
      value-deserializer: org.springframework.kafka.support.serializer.JsonDeserializer
      properties:
        spring.json.trusted.packages: "*" # Autorise la désérialisation de tous les packages
    producer:
      key-serializer: org.apache.kafka.common.serialization.StringSerializer
      value-serializer: org.springframework.kafka.support.serializer.JsonSerializer

# --- MONITORING (Actuator - Comme le Template) ---
management:
  endpoints:
    web:
      exposure:
        include: health,info,prometheus
  endpoint:
    health:
      probes:
        enabled: true
  metrics:
    export:
      prometheus:
        enabled: true

# --- SWAGGER (SpringDoc) ---
springdoc:
  api-docs:
    path: /v3/api-docs
  swagger-ui:
    path: /swagger-ui.html
    validator-url: none
  use-fqn: true

# --- CONFIGS MÉTIER ---
application:
  kafka:
    topics:
      crm-interactions: crm-interactions
      organization-events: organization-events
  
  security:
    jwt:
      secret: 404E635266556A586E3272357538782F413F4428472B4B6250645367566B5970
  cors:
    allowed-origins: "*"
      
# --- RESILIENCE (Circuit Breaker - Comme le Template) ---
resilience4j:
  circuitbreaker:
    instances:
      external-service: # Exemple générique
        failureRateThreshold: 50
        waitDurationInOpenState: 5s
        slidingWindowSize: 5
  
